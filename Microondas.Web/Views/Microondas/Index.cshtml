@model IEnumerable<Microondas.Web.Models.ProgramaPreDefinido>

@{
    Layout = null; /* Se não tiver um layout compartilhado */
    ViewBag.Title = "Micro-ondas Digital - Nível 2";
}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>@ViewBag.Title</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 20px;
        }

        .container {
            width: 800px;
            background: #333;
            color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            padding: 20px;
        }

        h2, h3 {
            margin-top: 0;
            text-align: center;
        }

        .status {
            background: #000;
            border-radius: 5px;
            padding: 10px;
            min-height: 40px;
            margin-bottom: 10px;
            color: #0f0;
            white-space: pre-wrap; /* para exibir string de \"...\" com quebras */
        }

        .section {
            margin-bottom: 10px;
            padding: 10px;
            background: #444;
            border-radius: 5px;
        }

        .form-group {
            margin-bottom: 8px;
        }

        label {
            display: inline-block;
            width: 110px;
        }

        input[type='number'] {
            width: 80px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #222;
        }

        th, td {
            border: 1px solid #555;
            padding: 6px;
        }

        th {
            background: #444;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .btn {
            background: #555;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            padding: 12px;
            cursor: pointer;
            text-align: center;
        }

            .btn:hover {
                background: #777;
            }

            .btn.start {
                background: #1e7c1e;
            }

            .btn.stop {
                background: #9a1a1a;
            }

        .info {
            font-size: 0.9em;
            color: #ff0;
            min-height: 1.2em;
        }

        .digital-input {
            margin-bottom: 6px;
        }

            .digital-input label {
                width: auto;
            }
    </style>
</head>
<body>
    <div class="container">
        <h2>Micro-ondas Digital (Nível 2)</h2>

        <!-- Mensagem do Controller (erros, resultado, etc.) -->
        <div class="status">
            @ViewBag.Mensagem
        </div>

        <!-- ============== SEÇÃO NÍVEL 1 (Tempo, Potência, Teclado Digital) ============= -->
        <div class="section">
            <h3>Aquecimento Manual</h3>

            <!-- Inputs manuais -->
            <div class="form-group">
                <label>Tempo (s):</label>
                <input type="number" id="manualTempo" min="1" max="120" />
            </div>
            <div class="form-group">
                <label>Potência (1-10):</label>
                <input type="number" id="manualPotencia" min="1" max="10" />
            </div>
            <button class="btn" onclick="usarValoresManuais()">Usar Valores</button>
            <p class="info">Ou use o teclado digital abaixo (se \"tempo\" = 0 => início rápido)</p>

            <!-- Teclado + forms hidden -->
            <form method="post" action="/Microondas/Iniciar" id="formIniciar">
                <input type="hidden" name="tempo" id="hiddenTempo" value="0" />
                <input type="hidden" name="potencia" id="hiddenPotencia" value="10" />
            </form>
            <form method="post" action="/Microondas/PausarCancelar" id="formStop"></form>

            <div class="buttons-grid" style="margin-bottom:6px;">
                <button type="button" class="btn" onclick="digit('1')">1</button>
                <button type="button" class="btn" onclick="digit('2')">2</button>
                <button type="button" class="btn" onclick="digit('3')">3</button>
                <button type="button" class="btn" onclick="digit('4')">4</button>
                <button type="button" class="btn" onclick="digit('5')">5</button>
                <button type="button" class="btn" onclick="digit('6')">6</button>
                <button type="button" class="btn" onclick="digit('7')">7</button>
                <button type="button" class="btn" onclick="digit('8')">8</button>
                <button type="button" class="btn" onclick="digit('9')">9</button>

                <button type="button" class="btn start" onclick="submitIniciar()">Start</button>
                <button type="button" class="btn" onclick="digit('0')">0</button>
                <button type="button" class="btn stop" onclick="submitStop()">Stop</button>
            </div>

            <p class="info" id="infoDigito">Tempo: 0, Potência: 10</p>
        </div>

        <!-- ============== SEÇÃO NÍVEL 2 (Programas Pré-Definidos) ============= -->
        <div class="section">
            <h3>Programas de Aquecimento Pré-Definidos</h3>
            <p class="info">Selecione um programa para aquecer sem alteração de tempo/potência.</p>

            <table>
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Alimento</th>
                        <th>Tempo</th>
                        <th>Potência</th>
                        <th>Instruções</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var prog in Model)
                    {
                        <tr>
                            <td>@prog.Nome</td>
                            <td>@prog.Alimento</td>
                            <td>@FormatarTempo(prog.TempoSegundos)</td>
                            <td>@prog.Potencia</td>
                            <td>@prog.Instrucoes</td>
                            <td>
                                <!-- Form para iniciar programa pré-definido -->
                                <form method="post" action="/Microondas/IniciarPrograma">
                                    <input type="hidden" name="nomePrograma" value="@prog.Nome" />
                                    <button type="submit" class="btn">Iniciar Programa</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @functions {
        private string FormatarTempo(int segundos)
        {
            if (segundos >= 60 && segundos < 100)
            {
                int m = segundos / 60;
                int s = segundos % 60;
                return $"{m}:{s:D2}";
            }
            else if (segundos >= 60)
            {
                int m = segundos / 60;
                int s = segundos % 60;
                return $"{m}min {s}s";
            }
            else
            {
                return $"{segundos}s";
            }
        }
    }

    <script>
        let tempoVal = 0;
        let potenciaVal = 10;

        // Digitação via teclado numérico
        function digit(num) {
            // Se tempoVal <120 => concat tempo
            let newTempo = parseInt(tempoVal.toString() + num);
            if (newTempo > 120) {
                newTempo = 120;
            }
            tempoVal = newTempo;
            updateInfo();
        }

        function updateInfo() {
            document.getElementById('infoDigito').textContent = 'Tempo: ' + tempoVal + ', Potência: ' + potenciaVal;
        }

        function submitIniciar() {
            // Se tempoVal=0 => inicio rápido => 30s, potencia=10
            document.getElementById('hiddenTempo').value = tempoVal;
            document.getElementById('hiddenPotencia').value = potenciaVal;
            document.getElementById('formIniciar').submit();
        }

        function submitStop() {
            document.getElementById('formStop').submit();
        }

        function usarValoresManuais() {
            let tManual = parseInt(document.getElementById('manualTempo').value);
            if (isNaN(tManual)) tManual = 0; // => 0 => Início rápido
            if (tManual > 120) tManual = 120;

            let pManual = parseInt(document.getElementById('manualPotencia').value);
            if (isNaN(pManual)) pManual = 10; // => default
            if (pManual > 10) pManual = 10;
            if (pManual < 1) pManual = 1;

            tempoVal = tManual;
            potenciaVal = pManual;
            updateInfo();
        }
    </script>
</body>
</html>
